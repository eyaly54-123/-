<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioPro Ultra | העורך המלא</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Heebo', 'sans-serif'] },
                    animation: { blob: "blob 7s infinite" },
                    keyframes: {
                        blob: {
                            "0%": { transform: "translate(0px, 0px) scale(1)" },
                            "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                            "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                            "100%": { transform: "translate(0px, 0px) scale(1)" },
                        }
                    },
                },
            },
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #3730a3; border-radius: 4px; }
        body { background-color: #020617; color: white; overflow-x: hidden; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .phone-mockup {
            width: 300px; height: 600px; border-radius: 45px; border: 8px solid #282828;
            position: relative; background: #000; overflow: hidden;
            box-shadow: 0 0 0 2px #444, 0 20px 50px -10px rgba(0,0,0,0.5); margin: 0 auto;
        }
        .dynamic-island {
            width: 90px; height: 24px; background: #000; position: absolute;
            top: 10px; left: 50%; transform: translateX(-50%); border-radius: 20px; z-index: 50;
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
    </div>

    <div id="authScreen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-[#020617] transition-all duration-700">
        <div class="p-10 bg-[#0f172a] border border-white/10 rounded-3xl text-center space-y-6 max-w-sm w-full mx-4">
            <h1 class="text-5xl font-black bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400">BioPro</h1>
            <input type="text" id="usernameInput" class="w-full bg-black/20 border border-white/10 p-3 rounded-xl text-center font-bold outline-none focus:border-indigo-500" placeholder="בחר שם משתמש">
            <button onclick="enterApp()" class="w-full bg-indigo-600 py-3 rounded-xl font-bold hover:bg-indigo-500 transition">התחל לעצב</button>
        </div>
    </div>

    <main id="appContainer" class="relative z-10 max-w-7xl mx-auto p-4 opacity-0 transition-opacity duration-1000 hidden">
        
        <header class="flex justify-between items-center mb-8 glass-panel p-4 rounded-2xl">
            <h2 class="font-bold text-lg flex items-center gap-2"><i class="fa-solid fa-pen-nib text-indigo-400"></i> עורך פרופיל</h2>
            <button onclick="generateShareableLink()" class="flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold shadow-lg transition">
                <i class="fa-solid fa-share-from-square"></i> פרסם ושמור
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-7 space-y-6">
                <div class="glass-panel p-6 rounded-3xl space-y-4">
                    <h3 class="font-bold text-slate-300">פרטים אישיים</h3>
                    <input type="text" id="nameField" oninput="render()" placeholder="שם מלא" class="w-full bg-[#020617] border border-white/10 p-4 rounded-xl outline-none text-white">
                    <input type="text" id="imgField" oninput="render()" placeholder="לינק לתמונה (URL)" class="w-full bg-[#020617] border border-white/10 p-4 rounded-xl outline-none text-white">
                    <textarea id="bioField" oninput="render()" rows="2" placeholder="כמה מילים עליך..." class="w-full bg-[#020617] border border-white/10 p-4 rounded-xl outline-none text-white"></textarea>
                </div>

                <div class="glass-panel p-6 rounded-3xl space-y-4">
                    <div class="flex justify-between">
                        <h3 class="font-bold text-slate-300">קישורים</h3>
                        <button onclick="addLink()" class="text-sm text-indigo-400 font-bold">+ הוסף קישור</button>
                    </div>
                    <div id="linksEditor" class="space-y-3"></div>
                </div>

                <div class="glass-panel p-6 rounded-3xl">
                    <h3 class="font-bold text-slate-300 mb-4">ערכת נושא</h3>
                    <div class="flex gap-4">
                        <button onclick="setTheme('dark')" class="w-12 h-12 rounded-full bg-slate-800 border-2 border-white/20"></button>
                        <button onclick="setTheme('sunset')" class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-600 border-2 border-white/20"></button>
                        <button onclick="setTheme('ocean')" class="w-12 h-12 rounded-full bg-gradient-to-br from-cyan-600 to-blue-600 border-2 border-white/20"></button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5">
                <div class="sticky top-4">
                    <div class="phone-mockup">
                        <div class="dynamic-island"></div>
                        <div id="phoneScreen" class="h-full overflow-y-auto no-scrollbar pt-16 pb-8 px-6 flex flex-col items-center text-center transition-colors duration-500 bg-slate-900">
                            <img id="prevImg" src="https://via.placeholder.com/150" class="w-24 h-24 rounded-full border-4 border-white/5 object-cover shadow-xl mb-4">
                            <h2 id="prevName" class="text-xl font-bold text-white mb-2">השם שלך</h2>
                            <p id="prevBio" class="text-sm text-white/70 mb-8 font-light">התיאור שלך יופיע כאן</p>
                            <div id="prevLinks" class="w-full space-y-3"></div>
                            <div class="mt-auto pt-8 opacity-30 text-[10px] uppercase tracking-widest text-white">Powered by BioPro</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // === הגדרות ונתונים ===
        let currentTheme = 'dark';
        const themes = {
            dark: { bg: '#0f172a', btn: 'bg-white/10' },
            sunset: { bg: 'linear-gradient(180deg, #4c1d95 0%, #be185d 100%)', btn: 'bg-black/20' },
            ocean: { bg: 'linear-gradient(180deg, #155e75 0%, #0891b2 100%)', btn: 'bg-white/20' }
        };

        // === פונקציות ליבה ===
        function enterApp() {
            const user = document.getElementById('usernameInput').value;
            if(!user) return alert('נא להזין שם משתמש');
            document.getElementById('authScreen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('appContainer').classList.remove('hidden');
                setTimeout(() => document.getElementById('appContainer').classList.remove('opacity-0'), 50);
            }, 500);
        }

        function addLink(titleVal = '', urlVal = '') {
            const container = document.getElementById('linksEditor');
            const div = document.createElement('div');
            div.className = 'link-input-row flex gap-2';
            div.innerHTML = `
                <input type="text" value="${titleVal}" placeholder="כותרת" class="link-title w-1/3 bg-black/20 p-3 rounded-xl border border-white/5 outline-none text-white text-sm" oninput="render()">
                <input type="text" value="${urlVal}" placeholder="URL" class="link-url w-2/3 bg-black/20 p-3 rounded-xl border border-white/5 outline-none text-indigo-400 text-sm" oninput="render()">
                <button onclick="this.parentElement.remove(); render()" class="text-red-400 px-2 hover:bg-red-500/10 rounded-lg"><i class="fa-solid fa-trash"></i></button>
            `;
            container.appendChild(div);
            render();
        }

        function render() {
            // טקסטים
            document.getElementById('prevName').innerText = document.getElementById('nameField').value || 'השם שלך';
            document.getElementById('prevBio').innerText = document.getElementById('bioField').value || 'כאן יופיע התיאור שלך...';
            
            const imgUrl = document.getElementById('imgField').value;
            if(imgUrl) document.getElementById('prevImg').src = imgUrl;

            // לינקים
            const previewContainer = document.getElementById('prevLinks');
            previewContainer.innerHTML = '';
            
            const inputs = document.querySelectorAll('.link-input-row');
            inputs.forEach(row => {
                const title = row.querySelector('.link-title').value;
                const url = row.querySelector('.link-url').value;
                if(title) {
                    const btn = document.createElement('a');
                    btn.href = url || '#';
                    btn.target = '_blank';
                    btn.className = `block w-full py-4 px-6 rounded-xl text-white font-bold transition hover:scale-[1.02] ${themes[currentTheme].btn} backdrop-blur-sm border border-white/10`;
                    btn.innerHTML = `<div class="flex items-center justify-between"><span>${title}</span> <i class="fa-solid fa-arrow-left opacity-50"></i></div>`;
                    previewContainer.appendChild(btn);
                }
            });
        }

        function setTheme(t) {
            currentTheme = t;
            document.getElementById('phoneScreen').style.background = themes[t].bg;
            render();
        }

        // === מנגנון שמירה ושיתוף ===
        function generateShareableLink() {
            // איסוף כל המידע
            const data = {
                u: document.getElementById('usernameInput').value,
                n: document.getElementById('nameField').value,
                b: document.getElementById('bioField').value,
                i: document.getElementById('imgField').value,
                t: currentTheme,
                l: []
            };

            document.querySelectorAll('.link-input-row').forEach(row => {
                data.l.push({
                    t: row.querySelector('.link-title').value,
                    u: row.querySelector('.link-url').value
                });
            });

            // קידוד ל-Base64 שתומך בעברית
            const jsonStr = JSON.stringify(data);
            const encoded = btoa(unescape(encodeURIComponent(jsonStr)));
            
            // יצירת לינק והעתקה
            const fullUrl = window.location.href.split('?')[0] + '?data=' + encoded;
            
            navigator.clipboard.writeText(fullUrl).then(() => {
                alert('✨ הלינק הועתק ללוח! \nשלח אותו לחברים או הדבק בטאב חדש לראות את התוצאה.');
            }).catch(err => {
                prompt("לא הצלחנו להעתיק אוטומטית. העתק מכאן:", fullUrl);
            });
        }

        // === טעינה מלינק ===
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const dataStr = params.get('data');

            if(dataStr) {
                try {
                    // פענוח
                    const jsonStr = decodeURIComponent(escape(atob(dataStr)));
                    const data = JSON.parse(jsonStr);

                    // מילוי שדות
                    document.getElementById('usernameInput').value = data.u || 'User';
                    document.getElementById('nameField').value = data.n || '';
                    document.getElementById('bioField').value = data.b || '';
                    document.getElementById('imgField').value = data.i || '';

                    // מילוי לינקים
                    if(data.l) {
                        data.l.forEach(link => addLink(link.t, link.u));
                    } else {
                        addLink(); // שורה ריקה להתחלה
                    }

                    setTheme(data.t || 'dark');

                    // כניסה מהירה (דילוג על מסך פתיחה)
                    enterApp();

                    // אם זה במובייל - נציג רק את התוצאה
                    if(window.innerWidth < 1024) {
                        document.querySelector('.lg\\:col-span-7').style.display = 'none'; // הסתרת עורך
                        document.querySelector('.lg\\:col-span-5').className = 'w-full flex justify-center'; // מרכוז טלפון
                    }

                } catch(e) {
                    console.error('Error loading data', e);
                    addLink();
                }
            } else {
                addLink(); // מצב עריכה חדש
            }
        }
    </script>
</body>
</html>
