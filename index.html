<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioPro Cloud | Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
body { 
    background: radial-gradient(circle at top right, #1e1b4b, #030712 50%, #000);
    background-attachment: fixed;
    color: white; 
    font-family: 'Inter', sans-serif; 
}
.glass { 
    background: rgba(255, 255, 255, 0.02); 
    backdrop-filter: blur(25px) saturate(150%); 
    border: 1px solid rgba(255, 255, 255, 0.1); 
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
}
/* ×ª×•×¡×™×£ ××ª ×–×” ×›×“×™ ×©×”×œ×™× ×§×™× ×™×›× ×¡×• ×‘×× ×™××¦×™×” */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.link-anim { animation: fadeIn 0.4s ease forwards; }â€â€œ
        /* Themes */
        .theme-classic { background: #050505; color: white; }
        .theme-ocean { background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%); color: white; }
        .theme-sunset { background: linear-gradient(135deg, #4c1d95 0%, #db2777 100%); color: white; }
        .theme-minimal { background: #ffffff; color: #111; }
    </style>
</head>
<body>

    <div id="loginScreen" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#030712]">
        <div class="relative glass p-10 rounded-[3rem] w-full max-w-md text-center space-y-8 mx-4 shadow-2xl">
            <h1 class="text-4xl font-black">BioPro <span class="text-indigo-500">Cloud</span></h1>
            <div class="space-y-4">
                <button onclick="authAction('google')" class="w-full flex items-center justify-center gap-3 p-4 bg-white text-black rounded-2xl font-bold hover:bg-slate-200 transition">
                    <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" class="w-5 h-5"> ×”××©×š ×¢× Google
                </button>
                <div class="opacity-20 text-xs text-white">××• ×‘×××¦×¢×•×ª ××™××™×™×œ</div>
                <input type="email" id="email" placeholder="××™××™×™×œ" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none text-center">
                <input type="password" id="pass" placeholder="×¡×™×¡××”" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none text-center">
                <button onclick="authAction('email')" class="w-full p-4 bg-indigo-600 rounded-2xl font-bold text-white">×›× ×™×¡×” / ×”×¨×©××”</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="hidden min-h-screen">
        <nav class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center">
            <span class="font-black italic text-indigo-500">BIOPRO PRO</span>
            <div class="flex gap-4">
                <button onclick="toggleShareMenu()" class="bg-indigo-600 px-4 py-2 rounded-full text-xs font-bold">×©×™×ª×•×£</button>
                <button onclick="auth.signOut()" class="text-slate-400"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </nav>

<div class="glass p-8 rounded-[2.5rem] space-y-6 relative overflow-hidden group">
    <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500/20 rounded-full blur-[50px] -z-10 pointer-events-none"></div>

    <h3 class="font-black text-2xl text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">
        <i class="fa-solid fa-user-astronaut ml-2"></i> ×”×’×“×¨×•×ª ×¤×¨×•×¤×™×œ
    </h3>

    <div class="relative">
        <i class="fa-regular fa-user absolute top-1/2 right-4 -translate-y-1/2 text-slate-400"></i>
        <input type="text" id="nameIn" oninput="autoSave()" placeholder="×©× ×”×ª×¦×•×’×” ×©×œ×š" 
        class="w-full bg-black/40 pr-10 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500 transition-all focus:bg-white/5 placeholder-slate-600">
    </div>

    <div class="relative">
        <i class="fa-solid fa-quote-right absolute top-4 right-4 text-slate-400 text-xs"></i>
        <textarea id="bioIn" oninput="autoSave()" placeholder="×›×ª×•×‘ ××©×”×• ×§×¦×¨ ×¢×œ ×¢×¦××š... (Bio)" rows="2"
        class="w-full bg-black/40 pr-10 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500 transition-all focus:bg-white/5 placeholder-slate-600 resize-none"></textarea>
    </div>

    <div class="grid grid-cols-2 gap-4">
        <div class="relative">
            <i class="fa-solid fa-phone absolute top-1/2 right-4 -translate-y-1/2 text-slate-400 text-xs"></i>
            <input type="text" id="phoneIn" oninput="autoSave()" placeholder="×˜×œ×¤×•×Ÿ" 
            class="w-full bg-black/40 pr-10 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500 transition-all text-sm">
        </div>
        <div class="relative">
            <i class="fa-solid fa-image absolute top-1/2 right-4 -translate-y-1/2 text-slate-400 text-xs"></i>
            <input type="text" id="imgIn" oninput="autoSave()" placeholder="×›×ª×•×‘×ª ×ª××•× ×” URL" 
            class="w-full bg-black/40 pr-10 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500 transition-all text-sm">
        </div>
    </div>

    <div class="pt-4 border-t border-white/5">
        <span class="text-xs text-slate-400 mb-2 block">×‘×—×¨ ×¢×™×¦×•×‘:</span>
        <div class="flex gap-3">
            <button onclick="setTheme('theme-classic')" class="w-10 h-10 rounded-full bg-black border-2 border-white/20 hover:scale-110 transition ring-2 ring-transparent focus:ring-indigo-500"></button>
            <button onclick="setTheme('theme-ocean')" class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-900 to-slate-900 border-2 border-white/20 hover:scale-110 transition"></button>
            <button onclick="setTheme('theme-sunset')" class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-600 to-purple-900 border-2 border-white/20 hover:scale-110 transition"></button>
            <button onclick="setTheme('theme-minimal')" class="w-10 h-10 rounded-full bg-white border-2 border-slate-200 hover:scale-110 transition"></button>
        </div>
    </div>
</div>

<div class="bg-[#0f0f11] border border-white/10 p-8 rounded-[2.5rem] text-center space-y-6 max-w-sm w-full relative overflow-hidden">
    <h3 class="text-xl font-bold text-white">×©×ª×£ ××ª ×”×›×¨×˜×™×¡</h3>
    
    <div class="relative group mx-auto w-fit">
        <div class="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl blur opacity-25 group-hover:opacity-75 transition duration-1000"></div>
        <div id="qrcode" class="relative bg-white p-3 rounded-xl"></div>
    </div>

    <div class="grid grid-cols-4 gap-2">
        <button onclick="shareTo('whatsapp')" class="p-3 rounded-xl bg-[#25D366]/10 text-[#25D366] hover:bg-[#25D366] hover:text-white transition"><i class="fa-brands fa-whatsapp text-xl"></i></button>
        <button onclick="shareTo('facebook')" class="p-3 rounded-xl bg-[#1877F2]/10 text-[#1877F2] hover:bg-[#1877F2] hover:text-white transition"><i class="fa-brands fa-facebook text-xl"></i></button>
        <button onclick="shareTo('linkedin')" class="p-3 rounded-xl bg-[#0A66C2]/10 text-[#0A66C2] hover:bg-[#0A66C2] hover:text-white transition"><i class="fa-brands fa-linkedin text-xl"></i></button>
        <button onclick="shareTo('twitter')" class="p-3 rounded-xl bg-[#1DA1F2]/10 text-[#1DA1F2] hover:bg-[#1DA1F2] hover:text-white transition"><i class="fa-brands fa-twitter text-xl"></i></button>
    </div>

    <button onclick="copyPublicLink()" class="flex items-center justify-center gap-2 w-full p-4 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl font-bold transition">
        <i class="fa-regular fa-copy"></i> ×”×¢×ª×§ ×§×™×©×•×¨
    </button>
    
    <button onclick="toggleShareMenu()" class="text-slate-500 text-sm hover:text-white transition">×¡×’×•×¨ ×—×œ×•× ×™×ª</button>
</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCQ4JuNyv-OLszK57jgjxsQi4qlOuSJkq8",
            authDomain: "biopro-55077.firebaseapp.com",
            projectId: "biopro-55077",
            storageBucket: "biopro-55077.firebasestorage.app",
            messagingSenderId: "590826980798",
            appId: "1:590826980798:web:c9a587aa501d30b849a5ef"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userData = { name: "", phone: "", img: "", theme: "theme-classic", links: [] };
        let saveTimeout;

        // Auth Logic
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').classList.remove('hidden');
                fetchUserData(user.uid);
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminPanel').classList.add('hidden');
            }
        });

        authAction
async function fetchUserData(uid) {
    const doc = await db.collection("users").doc(uid).get();
    if (doc.exists) {
        userData = doc.data();
        document.getElementById('nameIn').value = userData.name || "";
        document.getElementById('bioIn').value = userData.bio || ""; // <--- ×”×•×¡×¤× ×• ××ª ×–×”
        document.getElementById('phoneIn').value = userData.phone || "";
        document.getElementById('imgIn').value = userData.img || "";
        setTheme(userData.theme || 'theme-classic');
        renderEditor();
    }
    renderPreview();
}

        // Helper: Social Styles
        function getSocialStyle(url) {
            const l = url.toLowerCase();
            if(l.includes('instagram')) return { icon: 'fa-brands fa-instagram', color: 'bg-[#E1306C]' };
            if(l.includes('tiktok')) return { icon: 'fa-brands fa-tiktok', color: 'bg-black' };
            if(l.includes('wa.me') || l.includes('whatsapp')) return { icon: 'fa-brands fa-whatsapp', color: 'bg-[#25D366]' };
            return { icon: 'fa-solid fa-link', color: 'bg-indigo-600' };
        }

        function shareTo(platform) {
    const url = encodeURIComponent(window.location.href.split('?')[0] + "?u=" + auth.currentUser.uid);
    const text = encodeURIComponent("×”×™×™, ×ª×¨××• ××ª ×”×›×¨×˜×™×¡ ×”×“×™×’×™×˜×œ×™ ×”×—×“×© ×©×œ×™! ğŸš€");
    let shareUrl = "";

    if(platform === 'whatsapp') shareUrl = `https://wa.me/?text=${text} ${url}`;
    if(platform === 'facebook') shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    if(platform === 'linkedin') shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
    if(platform === 'twitter') shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;

    window.open(shareUrl, '_blank');
}

        function renderEditor() {
            const container = document.getElementById('linksEditor');
            container.innerHTML = '';
            userData.links.forEach((link, i) => {
                const d = document.createElement('div');
                d.className = "flex gap-2 items-center bg-white/5 p-3 rounded-xl";
                d.innerHTML = `
                    <div class="flex-1 space-y-1">
                        <input oninput="updateLink(${i}, 't', this.value)" value="${link.t}" placeholder="×›×•×ª×¨×ª" class="w-full bg-transparent text-sm font-bold outline-none">
                        <input oninput="updateLink(${i}, 'u', this.value)" value="${link.u}" placeholder="×œ×™× ×§" class="w-full bg-transparent text-xs text-indigo-400 outline-none">
                    </div>
                    <div class="text-[10px] opacity-30 text-center px-2">×§×œ×™×§×™×<br>${link.clicks || 0}</div>
                    <button onclick="removeLink(${i})" class="text-red-900"><i class="fa-solid fa-trash"></i></button>
                `;
                container.appendChild(d);
            });
        }

function renderPreview() {
    document.getElementById('pName').innerText = userData.name || "×”×©× ×©×œ×š";
    // ×”×•×¡×£ ××ª ×”××œ×× ×˜ ×”×–×” ×‘-HTML ×©×œ ×”×˜×œ×¤×•×Ÿ ×× ×”×•× ×œ× ×§×™×™×, ××• ×¦×•×¨ ××•×ª×• ×“×™× ××™×ª
let bioEl = document.getElementById('pBio');
if(!bioEl) {
    // ×™×•×¦×¨ ××ª ××œ×× ×˜ ×”×‘×™×• ×× ×”×•× ×œ× ×§×™×™×
    bioEl = document.createElement('p');
    bioEl.id = 'pBio';
    bioEl.className = "text-sm text-white/60 text-center px-4 mt-2 mb-4 font-light leading-relaxed";
    document.getElementById('pName').after(bioEl);
}
bioEl.innerText = userData.bio || "×›××Ÿ ×™×•×¤×™×¢ ×”×ª×™××•×¨ ×©×œ×š...";
    document.getElementById('pImg').src = userData.img || `https://ui-avatars.com/api/?name=${userData.name || 'User'}&background=random`;
    
    const container = document.getElementById('pLinks');
    container.innerHTML = ''; // ×× ×§×” ×”×›×œ ×œ×¤× ×™ ×¨×™× ×“×•×¨ ××—×“×©

    userData.links.forEach((l, i) => {
        if(!l.t) return;
        const style = getSocialStyle(l.u || "");
        const btn = document.createElement('a');
        btn.href = l.u || "#";
        btn.target = "_blank";
        // ×”×•×¡×¤×ª ×¢×™×¦×•×‘ ×“×™× ××™ ×œ×¤×™ ×”×ª××”
        const isMinimal = userData.theme === 'theme-minimal';
        btn.className = `link-anim flex items-center justify-between p-4 rounded-2xl transition-all duration-300 hover:scale-[1.03] shadow-lg ${isMinimal ? 'bg-white text-black' : style.color + ' text-white'}`;
        btn.style.animationDelay = `${i * 0.1}s`;
        btn.innerHTML = `<div class="flex items-center gap-3"><i class="${style.icon}"></i><span class="font-bold">${l.t}</span></div><i class="fa-solid fa-chevron-left opacity-30 text-xs"></i>`;
        btn.onclick = () => trackClick(auth.currentUser.uid, i);
        container.appendChild(btn);
    });
}

        function copyPublicLink() {
    const url = window.location.href.split('?')[0] + "?u=" + auth.currentUser.uid;
    navigator.clipboard.writeText(url).then(() => {
        alert("×”×§×™×©×•×¨ ×”×•×¢×ª×§! ×©×œ×— ××•×ª×• ×‘×•×•××˜×¡××¤");
    });
}

        function updateLink(i, f, v) { userData.links[i][f] = v; autoSave(); }
        function addNewLink() { userData.links.push({t:'', u:'', clicks:0}); renderEditor(); }
        function removeLink(i) { userData.links.splice(i, 1); renderEditor(); autoSave(); }
        
        function setTheme(t) { 
            userData.theme = t; 
            document.getElementById('previewScreen').className = `h-full pt-14 px-6 flex flex-col items-center overflow-y-auto no-scrollbar ${t}`;
            autoSave(); 
        }

function autoSave() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        userData.name = document.getElementById('nameIn').value;
        userData.bio = document.getElementById('bioIn').value; // <--- ×”×•×¡×¤× ×• ××ª ×–×”
        userData.phone = document.getElementById('phoneIn').value;
        userData.img = document.getElementById('imgIn').value;
        db.collection("users").doc(auth.currentUser.uid).set(userData).then(renderPreview);
    }, 500);
}

        function downloadVCard() {
            const v = `BEGIN:VCARD\nVERSION:3.0\nFN:${userData.name}\nTEL:${userData.phone}\nEND:VCARD`;
            const b = new Blob([v], {type:'text/vcard'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(b);
            a.download = "contact.vcf";
            a.click();
        }

        async function authAction(type) {
    try {
        if (type === 'google') {
            await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        } else {
            const e = document.getElementById('email').value, p = document.getElementById('pass').value;
            if(!e || !p) return alert("××œ× ×¤×¨×˜×™×");
            try { await auth.signInWithEmailAndPassword(e, p); } 
            catch { await auth.createUserWithEmailAndPassword(e, p); }
        }
    } catch (err) { alert(err.message); }
}

async function trackClick(uid, linkIndex) {
    const userRef = db.collection("users").doc(uid);
    // ×–×” ×”×× ×’× ×•×Ÿ ×©××•×•×“× ×©×”×¡×¤×™×¨×” ××“×•×™×§×ª ×’× ×× 100 ××™×© ×œ×•×—×¦×™× ×‘×©× ×™×™×”
    return db.runTransaction(async (transaction) => {
        const doc = await transaction.get(userRef);
        const links = doc.data().links;
        links[linkIndex].clicks = (links[linkIndex].clicks || 0) + 1;
        transaction.update(userRef, { links: links });
    });
}

        function toggleShareMenu() {
            const m = document.getElementById('shareModal');
            m.classList.toggle('hidden');
            if(!m.classList.contains('hidden')) {
                const url = window.location.href.split('?')[0] + "?u=" + auth.currentUser.uid;
                document.getElementById('qrcode').innerHTML = "";
                new QRCode(document.getElementById("qrcode"), { text: url, width: 120, height: 120 });
            }
        }
    </script>
</body>
</html>
