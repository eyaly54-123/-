<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioPro Pro | Cloud Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        body { background-color: #030712; color: white; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .phone-container { 
            width: 320px; height: 650px; border: 12px solid #1f2937; border-radius: 48px; 
            position: relative; overflow: hidden; background: #000; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.7);
        }
        .link-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .link-card:hover { transform: translateY(-3px) scale(1.02); }
        .shimmer { background: linear-gradient(90deg, #1f2937 25%, #374151 50%, #1f2937 75%); background-size: 200% 100%; animation: shimmer 2s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased">

    <div id="loginScreen" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#030712]">
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-indigo-600/20 rounded-full blur-[120px]"></div>
            <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[120px]"></div>
        </div>
        
        <div class="relative glass p-10 rounded-[3rem] w-full max-w-md text-center space-y-8">
            <div class="space-y-2">
                <div class="bg-indigo-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto shadow-2xl rotate-3">
                    <i class="fa-solid fa-bolt text-3xl"></i>
                </div>
                <h1 class="text-4xl font-black mt-4">BioPro <span class="text-indigo-500">Cloud</span></h1>
                <p class="text-slate-400 text-sm">המערכת המתקדמת לניהול נוכחות דיגיטלית</p>
            </div>

            <div class="space-y-3">
                <button onclick="authAction('google')" class="w-full flex items-center justify-center gap-3 p-4 bg-white text-black rounded-2xl font-bold hover:bg-slate-200 transition">
                    <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" class="w-5 h-5">
                    המשך עם Google
                </button>
                <div class="flex items-center gap-4 py-2 opacity-20">
                    <hr class="flex-1 border-white"> <span class="text-xs">OR</span> <hr class="flex-1 border-white">
                </div>
                <input type="email" id="email" placeholder="אימייל" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500">
                <input type="password" id="pass" placeholder="סיסמה" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500">
                <button onclick="authAction('email')" class="w-full p-4 bg-indigo-600 rounded-2xl font-bold hover:bg-indigo-500 transition shadow-lg shadow-indigo-600/40">
                    כניסה / הרשמה מהירה
                </button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="hidden min-h-screen">
        <nav class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <span class="bg-indigo-600 px-3 py-1 rounded-md text-xs font-black italic">PRO</span>
                <span id="userNameDisplay" class="text-sm font-bold opacity-70">משתמש מחובר</span>
            </div>
            <div class="flex gap-4">
                <button onclick="copyPublicLink()" class="text-xs font-bold bg-white/5 px-4 py-2 rounded-full border border-white/10 hover:bg-white/10 transition">
                    <i class="fa-solid fa-link ml-2"></i> העתק לינק ציבורי
                </button>
                <button onclick="firebase.auth().signOut()" class="text-slate-500 hover:text-red-400 transition"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-10 p-6">
            <div class="lg:col-span-7 space-y-6">
                <div class="glass p-8 rounded-[2.5rem] space-y-6">
                    <h3 class="text-xl font-bold text-indigo-400 flex items-center gap-3">
                        <i class="fa-solid fa-circle-user"></i> הגדרות פרופיל
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] uppercase tracking-widest text-slate-500 font-bold">שם מלא</label>
                            <input type="text" id="nameIn" oninput="autoSave()" class="w-full bg-black/40 p-4 rounded-xl border border-white/5 outline-none focus:border-indigo-500">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] uppercase tracking-widest text-slate-500 font-bold">תמונה (URL)</label>
                            <input type="text" id="imgIn" oninput="autoSave()" class="w-full bg-black/40 p-4 rounded-xl border border-white/5 outline-none focus:border-indigo-500">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] uppercase tracking-widest text-slate-500 font-bold">ביוגרפיה</label>
                        <textarea id="bioIn" oninput="autoSave()" class="w-full bg-black/40 p-4 rounded-xl border border-white/5 h-24 outline-none focus:border-indigo-500"></textarea>
                    </div>
                </div>

                <div class="glass p-8 rounded-[2.5rem] space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-indigo-400">ניהול קישורים</h3>
                        <button onclick="addNewLink()" class="bg-indigo-600/20 text-indigo-400 text-xs px-4 py-2 rounded-full font-bold hover:bg-indigo-600/30">+ הוסף קישור</button>
                    </div>
                    <div id="linksEditor" class="space-y-4"></div>
                </div>
            </div>

            <div class="lg:col-span-5">
                <div class="sticky top-28 flex flex-col items-center">
                    <div class="phone-container">
                        <div class="absolute top-0 w-full h-6 bg-black z-40"></div>
                        <div id="previewScreen" class="h-full bg-[#050505] overflow-y-auto no-scrollbar pt-14 px-6 pb-10 flex flex-col items-center">
                            <img id="pImg" src="https://ui-avatars.com/api/?name=User" class="w-24 h-24 rounded-full border-4 border-white/5 shadow-2xl">
                            <h2 id="pName" class="mt-6 text-2xl font-black">השם שלך</h2>
                            <p id="pBio" class="mt-2 text-sm text-center text-slate-400 font-medium"></p>
                            
                            <div id="pLinks" class="w-full mt-10 space-y-4"></div>
                            
                            <div class="mt-auto pt-10 text-[10px] opacity-20 uppercase font-black tracking-widest">BioPro Pro Edition</div>
                        </div>
                    </div>
                    <div id="saveStatus" class="mt-4 text-xs text-slate-500 font-mono">כל השינויים נשמרו בענן</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyCQ4JuNyv-OLszK57jgjxsQi4qlOuSJkq8",
            authDomain: "biopro-55077.firebaseapp.com",
            projectId: "biopro-55077",
            storageBucket: "biopro-55077.firebasestorage.app",
            messagingSenderId: "590826980798",
            appId: "1:590826980798:web:c9a587aa501d30b849a5ef",
            measurementId: "G-9VL8ZG0HR2"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userData = { name: "", bio: "", img: "", links: [] };
        let saveTimeout;

        // --- Authentication ---
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('userNameDisplay').innerText = user.email;
                fetchUserData(user.uid);
            } else {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
            }
        });

        function authAction(type) {
            if(type === 'google') {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider);
            } else {
                const email = document.getElementById('email').value;
                const pass = document.getElementById('pass').value;
                auth.signInWithEmailAndPassword(email, pass).catch(() => {
                    auth.createUserWithEmailAndPassword(email, pass);
                });
            }
        }

        // --- Data Logic ---
        async function fetchUserData(uid) {
            const doc = await db.collection("users").doc(uid).get();
            if (doc.exists) {
                userData = doc.data();
                document.getElementById('nameIn').value = userData.name || "";
                document.getElementById('imgIn').value = userData.img || "";
                document.getElementById('bioIn').value = userData.bio || "";
                renderEditor();
            } else {
                addNewLink();
            }
            renderPreview();
        }

        function renderEditor() {
            const container = document.getElementById('linksEditor');
            container.innerHTML = '';
            userData.links.forEach((link, index) => {
                const div = document.createElement('div');
                div.className = "glass p-4 rounded-2xl flex gap-3 items-center animate-in slide-in-from-right";
                div.innerHTML = `
                    <div class="flex-1 space-y-2">
                        <input type="text" value="${link.t}" placeholder="כותרת" oninput="updateLinkData(${index}, 't', this.value)" class="w-full bg-transparent outline-none font-bold text-sm">
                        <input type="text" value="${link.u}" placeholder="URL" oninput="updateLinkData(${index}, 'u', this.value)" class="w-full bg-transparent outline-none text-indigo-400 text-xs">
                    </div>
                    <button onclick="removeLink(${index})" class="text-slate-600 hover:text-red-500 transition"><i class="fa-solid fa-trash-can"></i></button>
                `;
                container.appendChild(div);
            });
        }

        function updateLinkData(index, field, value) {
            userData.links[index][field] = value;
            autoSave();
            renderPreview();
        }

        function addNewLink() {
            userData.links.push({ t: "", u: "", clicks: 0 });
            renderEditor();
        }

        function removeLink(index) {
            userData.links.splice(index, 1);
            renderEditor();
            autoSave();
            renderPreview();
        }

        function autoSave() {
            document.getElementById('saveStatus').innerText = "שומר...";
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const user = auth.currentUser;
                userData.name = document.getElementById('nameIn').value;
                userData.img = document.getElementById('imgIn').value;
                userData.bio = document.getElementById('bioIn').value;
                
                db.collection("users").doc(user.uid).set(userData).then(() => {
                    document.getElementById('saveStatus').innerText = "נשמר בענן ✓";
                    renderPreview();
                });
            }, 1000);
        }

        // --- Preview Logic & UI Upgrades ---
        function getSocialIcon(url) {
            const lowUrl = url.toLowerCase();
            if(lowUrl.includes('instagram')) return { i: 'fa-brands fa-instagram', c: 'bg-[#E1306C]' };
            if(lowUrl.includes('tiktok')) return { i: 'fa-brands fa-tiktok', c: 'bg-[#000000]' };
            if(lowUrl.includes('youtube')) return { i: 'fa-brands fa-youtube', c: 'bg-[#FF0000]' };
            if(lowUrl.includes('facebook')) return { i: 'fa-brands fa-facebook', c: 'bg-[#1877F2]' };
            if(lowUrl.includes('whatsapp') || lowUrl.includes('wa.me')) return { i: 'fa-brands fa-whatsapp', c: 'bg-[#25D366]' };
            return { i: 'fa-solid fa-link', c: 'bg-white/10' };
        }

        function renderPreview() {
            document.getElementById('pName').innerText = userData.name || "השם שלך";
            document.getElementById('pBio').innerText = userData.bio || "";
            if(userData.img) document.getElementById('pImg').src = userData.img;

            const container = document.getElementById('pLinks');
            container.innerHTML = '';
            userData.links.forEach(l => {
                if(!l.t) return;
                const style = getSocialIcon(l.u);
                const a = document.createElement('a');
                a.href = l.u || "#";
                a.target = "_blank";
                a.className = `link-card flex items-center justify-between w-full p-4 rounded-2xl ${style.c} text-white font-bold shadow-xl`;
                a.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="${style.i} text-xl"></i>
                        <span class="text-sm">${l.t}</span>
                    </div>
                    <i class="fa-solid fa-chevron-left text-[10px] opacity-50"></i>
                `;
                container.appendChild(a);
            });
        }

        function copyPublicLink() {
            const publicUrl = window.location.href.split('?')[0] + "?u=" + auth.currentUser.uid;
            navigator.clipboard.writeText(publicUrl);
            alert("הלינק הציבורי הועתק! עכשיו כולם יכולים לראות את הדף שלך.");
        }

        // --- Public View Logic ---
        window.onload = async () => {
            const params = new URLSearchParams(window.location.search);
            const publicUid = params.get('u');
            if (publicUid) {
                // מצב צפייה ציבורי - מסתירים הכל ומראים רק את הטלפון
                document.body.innerHTML = `<div class="flex items-center justify-center min-h-screen bg-black">
                    <div id="previewScreen" class="w-full max-w-md h-screen bg-[#050505] p-6 flex flex-col items-center overflow-y-auto">
                        <div id="publicContent" class="w-full flex flex-col items-center pt-10"></div>
                    </div>
                </div>`;
                const doc = await db.collection("users").doc(publicUid).get();
                if(doc.exists) {
                    const data = doc.data();
                    const content = document.getElementById('publicContent');
                    content.innerHTML = `
                        <img src="${data.img}" class="w-28 h-28 rounded-full border-4 border-white/5 shadow-2xl">
                        <h1 class="text-3xl font-black mt-6">${data.name}</h1>
                        <p class="text-slate-400 mt-2 text-center">${data.bio}</p>
                        <div class="w-full mt-10 space-y-4">${data.links.map(l => {
                            const s = getSocialIcon(l.u);
                            return `<a href="${l.u}" target="_blank" class="flex items-center justify-between w-full p-5 rounded-2xl ${s.c} text-white font-bold shadow-lg">
                                <div class="flex items-center gap-3"><i class="${s.i} text-2xl"></i><span>${l.t}</span></div>
                                <i class="fa-solid fa-arrow-up-right-from-square text-xs opacity-50"></i>
                            </a>`;
                        }).join('')}</div>
                    `;
                }
            }
        };
    </script>
</body>
</html>
